<!DOCTYPE html>
<html lang="zh-Hunt" xmlns:th="http://www.thymeleaf.org">
<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <link href="http://yui.yahooapis.com/3.18.1/build/cssreset/cssreset-min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com" rel="preconnect">
    <link crossorigin href="https://fonts.gstatic.com" rel="preconnect">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@100..900&display=swap" rel="stylesheet">
    <link crossorigin="anonymous" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
          integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
          referrerpolicy="no-referrer"
          rel="stylesheet"/>
    <link rel="stylesheet" th:href="@{/styles/side_bar.css}"/>
    <link rel="stylesheet" th:href="@{/styles/homepage.css}"/>
    <link rel="stylesheet" th:href="@{/styles/set_homepage.css}"/>
    <link rel="stylesheet" th:href="@{/styles/admin.css}"/>
    <title>首頁設定</title>
</head>
<body id="homepage-setting-body">
<nav id="homepage-setting-nav" th:insert="~{fragment/admin_sidebar.html:: admin_sidebar}"></nav>
<main id="homepage-setting-main">
    <div id="homepage-preview" th:insert="~{webpage/homepage.html:: homepageFragment}"></div>
    <div id="setting-form">
        <!--        <h2>機構資料設定</h2>-->
        <!--        <div th:switch="${action}">-->
        <!--            <div th:case="'get-info'">-->
        <!--                <label for="institution_name" th:text="'機構名稱: ' + ${i.institutionName}"></label>-->
        <!--                <br>-->
        <!--                <label for="tel" th:text="'電話: ' + ${i.tel}"></label>-->
        <!--                <br>-->
        <!--                <label for="address" th:text="'地址: ' + ${i.address}"></label>-->
        <!--                <br>-->
        <!--                <label for="business_hour" th:text="'營業時間: '"></label>-->
        <!--                <p th:utext=" ${businessHour}"></p>-->
        <!--                <br>-->
        <!--                <button id="btn-change">更改</button>-->
        <!--            </div>-->
        <!--            <div th:case="'get-info-form'">-->
        <!--                <form id="institution-form" method="post">-->
        <!--                    <label for="institution_name">機構名稱:</label>-->
        <!--                    <input id="institution_name" name="institutionName" required th:value="${i.institutionName}"-->
        <!--                           type="text">-->
        <!--                    <br>-->
        <!--                    <label for="tel">電話:</label>-->
        <!--                    <input id="tel" name="tel" required th:value="${i.tel}" type="text">-->
        <!--                    <br>-->
        <!--                    <label for="address">地址:</label>-->
        <!--                    <input id="address" name="address" required th:value="${i.address}" type="text">-->
        <!--                    <br>-->
        <!--                    <label for="business_hour">營業時間:</label>-->
        <!--                    <br>-->
        <!--                    <textarea id="business_hour" name="businessHour" required th:utext="${i.businessHour}"></textarea>-->
        <!--                    <br>-->
        <!--                    <button id="btn-update">儲存</button>-->
        <!--                </form>-->
        <!--                <button id="btn-cancel">取消</button>-->
        <!--            </div>-->
        <!--        </div>-->

        <h2>首頁設定</h2>
        <form enctype="multipart/form-data" id="homepage-form" method="post" th:object="${HomepageForm}">
            <h3>機構介紹</h3>
            <label for="logo">機構 Logo </label>
            <input id="logo" name="logo" required type="file">
            <br>
            <label for="main-image">主要圖片 </label>
            <input id="main-image" name="mainImage" required type="file"/>
            <br>
            <label for="image-intro">圖片敘述: </label>
            <br>
            <textarea id="image-intro" name="imageDescription" required
                      th:text="${homePage.imageDescription}"></textarea>
            <br>
            <label for="institution-intro">關於我們:</label>
            <br>
            <textarea id="institution-intro" name="institutionIntro" required
                      th:text="${homePage.institutionIntro}"></textarea>
            <h3>選擇顏色</h3>
            <div>
                <input id="color-red" name="color" required type="radio" value="1"/>
                <label for="color-red">紅色</label>
                <input id="color-orange" name="color" type="radio" value="2"/>
                <label for="color-orange">橘色</label>
                <input id="color-green" name="color" type="radio" value="3"/>
                <label for="color-green">綠色</label>
                <input id="color-blue" name="color" type="radio" value="4"/>
                <label for="color-blue">藍色</label>
                <input id="color-purple" name="color" type="radio" value="5"/>
                <label for="color-purple">紫色</label>
            </div>
            <button class="preview" id="btn-preview-style">預覽</button>
            <button class="save" id="btn-update-style">儲存</button>
        </form>
        <button class="cancel" id="btn-cancel-style">取消</button>
    </div>
</main>

</body>
<script>
    // // Institution setting
    // // change to form page
    // $('#btn-change').click(() => {
    //     const currentUrl = window.location.href;
    //     window.location.href = currentUrl.split('?')[0] + "?action=update";
    // });
    //
    // $('#btn-cancel').click(() => {
    //     const currentUrl = window.location.href;
    //     window.location.href = currentUrl.split('?')[0];
    // });
    //
    // // POST form data to back end
    // let targetURL = window.location.href.split('?')[0] + "/update/institution";
    // $('#institution-form').attr('action', targetURL)

    // homepage style setting
    // POST form data to back end

    $("#btn-preview-style").click(function (event) {
        let form = $("#homepage-form")[0];
        if (!form.checkValidity()) {
            return;
        }
        event.preventDefault();

        let formData = new FormData(form);
        const baseUrl = window.location.href.split('?')[0];
        let endpoint = baseUrl + "/preview"
        try {
            (async function postData() {
                await sendData(formData, endpoint);
                window.location.href = baseUrl + "?action=preview"
            })()
        } catch (error) {
            console.error('Error:', error);
        }
    });

    $("#btn-update-style").click(function (event) {
        let form = $("#homepage-form")[0];
        if (!form.checkValidity()) {
            return;
        }
        event.preventDefault();

        let formData = new FormData(form);
        const baseUrl = window.location.href.split('?')[0];
        let endpoint = baseUrl + "/update/style"
        try {
            (async function postData() {
                await sendData(formData, endpoint);
                window.location.href = baseUrl;
            })()
        } catch (error) {
            console.error('Error:', error);
        }
    });

    $('#btn-cancel-style').click(() => {
        const currentUrl = window.location.href;
        window.location.href = currentUrl.split('?')[0];
    });

    async function sendData(formData, endpoint) {
        try {
            let response = await fetch(endpoint, {
                method: 'POST',
                body: formData
            });
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
        } catch (error) {
            console.error('There has been a problem with your fetch operation:', error);
            throw error;
        }
    }

</script>
</html>